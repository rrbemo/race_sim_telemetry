import socket
import struct
import time
from packets import (
    PacketHeader,
    PacketID,
    HeaderFieldsToPacketType,
    unpack_udp_packet,
)

from collections import namedtuple

TimestampedPacket = namedtuple("TimestampedPacket", "timestamp, packet")

UDP_IP = "127.0.0.1"
UDP_PORT = 22022

sock = socket.socket(socket.AF_INET, # Internet
                     socket.SOCK_DGRAM) # UDP
sock.bind((UDP_IP, UDP_PORT))

data = b'\xe6\x07\x01\t\x01\x03`\xb9\xdeM\xff)\xfe\xebN\x826C\x18(\x00\x00\x00\xffBUTN\x10\x08\x00\x00Z\x17-WZ\x17-W'
#data = b'\xe6\x07\x01\t\x01\x00`\xb9\xdeM\xff)\xfe\xeb\xe2\x8a6C\x1a(\x00\x00\x00\xff\x99\x812C\x9a\x9c0@\x8b(;D\xff{\r;-\'\xd1\xba\xa0\x1dw\xb8\xd3\x98\xfc\x02\xafKL\xb4\x1b\x00\xcb\x98#5\xca:\xc0[\xbb;T\xe9\x1a\xbc!\x13p\xbf@R\x9e<\xa2\x8f_\xba\xa9\n\xc7\xc2\xd8\xbbA@\xfa\xa9\xeaC\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x93\xa4Z\xffn\xa6\x8fY\xd6\xfc\x9d\xa4\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb9"\x16\xc0\x00\x04`<9\x9b\xca<\xc7\x13\xc4\xc29MC@O\xb0\xefC\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x06\xa3O\xff\n\xa8\xeaW~\x03\x0b\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x90\x01\x15\xc0\x00\xeb\xb9\xbc\xd7\x98\xdf\xbc\xc7\xc7\xaf\xc2\xc5\xb4F@4)\xf0C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xed\xa2[\xff%\xa8\xd7W\xb1\xfc\xf7\xa2\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe7\xf1\x14\xc0\x00\x9ff<^\xe9\xd3<g\x15\xad\xc26\xc4G@\xdb@\xf5C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00+\xa3a\xff\xe3\xa7\x12Xu\x030\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb4\x1c\x15\xc0\x80g\xb5\xbc\x8dg\xdd\xbcO\x8d\x98\xc2\x06\xb8J@\x1b\xb0\xf5C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe3\xa3\x84\xff#\xa7\xd9X\xc0\xfc\xec\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\xa4\x15\xc0\x00]t<\xb7-\xd0<M\xd4\x95\xc2\x15\xd8M@\xdd\xbe\xfaC\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x96\xa4\xf0\xfel\xa6\x88Yt\x03\x98\xa4\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x006!\x16\xc0\x00b\xcb\xbc\x8d!\xdd\xbc\xa9y\x81\xc2\xd3@P@<.\xfbC\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb1\xa3X\xffW\xa7\xa5X\xc4\xfc\xbb\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00=\x80\x15\xc0\x80]b<\xe8E\xcf< \xe6}\xc2\x8c\xe3R@"$\x00D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x8d\xa3m\xff|\xa7zXO\x03\x92\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00Nd\x15\xc0\x001\xad\xbc\xf8\xcf\xd3\xbc\xa8>T\xc2\xa6\x8cV@\xecR\x00D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00e\xa3w\xff\xa5\xa7TXQ\xfcr\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd5H\x15\xc0\x00\x0f\x8a<\x11\xf9\xeb<\xaf\xe8N\xc2j\xd4X@i\xe3\x02D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x86\xa4\xac\xffz\xa6|Ye\x03\x8c\xa4\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00s\x17\x16\xc0\x00*\xa7\xbc\xa0n\xd9\xbc\xb3\xe9%\xc24\x1aX@-\x1d\x03D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x001\xa3\xd5\xff\xdc\xa7\x1cX6\xfc=\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00^"\x15\xc0\x000\x9f<9\x8b\xf2<$\x85 \xc2\xeeUZ@=\xa6\x05D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00q\xa4\xec\xff\x90\xa6hYV\x03x\xa4\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\t\x16\xc0\xc0\xdd\x98\xbcv\x94\xd5\xbc\xe9W\xf0\xc1\xfa\xa7Y@\xd4\xe9\x05D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xad\xa3\xef\xffZ\xa7\x9dXs\xfc\xb6\xa3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02|\x15\xc0@^\x9a<\xeaZ\xe3<\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe3=\nB\xcf\xe9\xffA!\xe6\x0bB\xe7+\x15Bn\x15\xaf?"\xed\xca\xbfn\x04\xfd?.\x9d\xae\xbf\xc6\xbdEB\xe1\xf3\xee\xc2iU\x1fC\xeb\x042\xc2`+\xc2\xae\xf3\x8dz\x9f\x00\x00\x00\x00\x00\x00\x00\x007\xcc\xb5:\xad&\xb5:q\x17\xc8:\xc6\x8b\xc4:\xe9P\xa1:\xbb\x86\xcb\xba\xdc\x8c\xed\xba\xaa\xf8}\xbb\xe4\xc0\x878\x1bM\x85;\x19^\xc6\xbef\np9\x14\xdf\x95=J[\x8e\xbe'

quitflag = False
#while not quitflag:
#    udp_packet = sock.recv(2048)
#    packet = unpack_udp_packet(udp_packet)
print(unpack_udp_packet(data))
